<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Manipulating data types #  A binary tree #  In lectures we saw (repeatedly) a binary tree with values at nodes and empty leaves. This time, we&rsquo;re going to make a tree that holds values at nodes and leaves, and then do some manipulation of it.
Our data type is
data Tree a = Leaf a | Node (Tree a) a (Tree a) deriving (Eq, Show) The template code/trees-exercise6.hs also defines some helper functions to construct trees of various kinds"><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Some classic data structures"><meta property="og:description" content="Manipulating data types #  A binary tree #  In lectures we saw (repeatedly) a binary tree with values at nodes and empty leaves. This time, we&rsquo;re going to make a tree that holds values at nodes and leaves, and then do some manipulation of it.
Our data type is
data Tree a = Leaf a | Node (Tree a) a (Tree a) deriving (Eq, Show) The template code/trees-exercise6.hs also defines some helper functions to construct trees of various kinds"><meta property="og:type" content="article"><meta property="og:url" content="https://comp2221.github.io/fp-website/exercises/exercise6/"><meta property="article:section" content="exercises"><meta property="article:modified_time" content="2024-02-13T17:15:18+00:00"><title>Some classic data structures | COMP2221 – Functional Programming</title><link rel=manifest href=/fp-website/manifest.json><link rel=icon href=/fp-website/favicon.png type=image/x-icon><link rel=stylesheet href=/fp-website/book.min.b85762cbec3aa7dfc1fa14ce1d900668d26349753560425c37dac8f9e08407d6.css integrity="sha256-uFdiy+w6p9/B+hTOHZAGaNJjSXU1YEJcN9rI+eCEB9Y="><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><div class=book-brand><img class=book-center src=/fp-website/logo.svg alt=Logo><h2><a href=/fp-website>COMP2221 – Functional Programming</a></h2></div><ul><li><a href=/fp-website/setup/>Setup</a><ul></ul></li><li><a href=/fp-website/slides/>Slides & Recordings</a></li><li><a href=/fp-website/exercises/>Exercises</a><ul><li><a href=/fp-website/exercises/exercise1/>Hello, World!</a></li><li><a href=/fp-website/exercises/exercise2/>Types and lists</a></li><li><a href=/fp-website/exercises/exercise3/>List manipulation and sorting</a></li><li><a href=/fp-website/exercises/exercise4/>Lazy evaluation and infinite datastructures</a></li><li><a href=/fp-website/exercises/exercise5/>Folds and function composition</a></li><li><a href=/fp-website/exercises/exercise6/ class=active>Some classic data structures</a></li><li><a href=/fp-website/exercises/exercise7/>Another mini expression evaluator</a></li><li><a href=/fp-website/exercises/exercise8/>Model Exam</a></li></ul></li><li><span>Past editions</span><ul><li><span>2020/21</span><ul><li><a href=/fp-website/past-editions/2020-21/lectures/>Annotated slides</a></li></ul></li><li><span>2021/22</span><ul><li><a href=/fp-website/past-editions/2021-22/lectures/>Slides & commentary</a></li></ul></li><li><span>2022/23</span><ul><li><a href=/fp-website/past-editions/2022-23/lectures/>Slides & Recordings</a></li></ul></li></ul></li></ul></nav><script>(function(){var a=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/fp-website/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Some classic data structures</strong>
<label for=toc-control><img src=/fp-website/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#manipulating-data-types>Manipulating data types</a><ul><li><a href=#a-binary-tree>A binary tree</a></li><li><a href=#a-simple-calculator>A simple calculator</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=manipulating-data-types>Manipulating data types
<a class=anchor href=#manipulating-data-types>#</a></h1><h2 id=a-binary-tree>A binary tree
<a class=anchor href=#a-binary-tree>#</a></h2><p>In lectures we saw (repeatedly) a binary tree with values at nodes and
empty leaves. This time, we&rsquo;re going to make a tree that holds values
at nodes and leaves, and then do some manipulation of it.</p><p>Our data type is</p><div class=highlight><pre style=color:#272822;background-color:#fafafa><code class=language-hs data-lang=hs><span style=color:#00a8c8>data</span> <span style=color:#00a8c8>Tree</span> <span style=color:#111>a</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>Leaf</span> <span style=color:#111>a</span> <span style=color:#f92672>|</span> <span style=color:#00a8c8>Node</span> <span style=color:#111>(</span><span style=color:#00a8c8>Tree</span> <span style=color:#111>a</span><span style=color:#111>)</span> <span style=color:#111>a</span> <span style=color:#111>(</span><span style=color:#00a8c8>Tree</span> <span style=color:#111>a</span><span style=color:#111>)</span>
  <span style=color:#00a8c8>deriving</span> <span style=color:#111>(</span><span style=color:#00a8c8>Eq</span><span style=color:#111>,</span> <span style=color:#00a8c8>Show</span><span style=color:#111>)</span>
</code></pre></div><p>The template <a href=https://comp2221.github.io/fp-website/code/trees-exercise6.hs><code>code/trees-exercise6.hs</code></a> also defines some helper functions to
construct trees of various kinds</p><div class=highlight><pre style=color:#272822;background-color:#fafafa><code class=language-hs data-lang=hs><span style=color:#75715e>-- Produce a &#34;balanced&#34; tree with the specified number of nodes</span>
<span style=color:#75af00>makeBalancedTree</span> <span style=color:#f92672>::</span> <span style=color:#00a8c8>Int</span> <span style=color:#f92672>-&gt;</span> <span style=color:#00a8c8>Tree</span> <span style=color:#00a8c8>Int</span>
<span style=color:#75715e>-- Take a tree and produce a new tree that is mirror-symmetric</span>
<span style=color:#75af00>mirrorTree</span> <span style=color:#f92672>::</span> <span style=color:#00a8c8>Tree</span> <span style=color:#111>a</span> <span style=color:#f92672>-&gt;</span> <span style=color:#00a8c8>Tree</span> <span style=color:#111>a</span>
</code></pre></div><p>We&rsquo;ll first implement some type class instances for our data type.</p><blockquote class=exercise><h3>Exercise</h3><span><p>Implement <code>Functor</code> and <code>Foldable</code> instances for the <code>Tree</code> data type.</p><p>Show that your implementation of <code>fmap</code> obeys the two functor laws.</p><details><summary>Hint</summary><div class=markdown-inner><p>We&rsquo;ll use these instances to implement functionality transforming
trees later, so if you couldn&rsquo;t figure it out, don&rsquo;t forget that you
can add</p><div class=highlight><pre style=color:#272822;background-color:#fafafa><code class=language-hs data-lang=hs><span style=color:#75715e>{-# LANGUAGE DeriveFunctor #-}</span>
<span style=color:#75715e>{-# LANGUAGE DeriveFoldable #-}</span>
</code></pre></div><p>At the top of your file and add <code>deriving (Functor, Foldable)</code> to the
<code>data</code> declaration.</p></div></details></span></blockquote><p>To help construct trees, we&rsquo;ll build minimal depth trees from lists
with <code>toTree</code></p><blockquote class=exercise><h3>Exercise</h3><span><p>Define</p><div class=highlight><pre style=color:#272822;background-color:#fafafa><code class=language-hs data-lang=hs><span style=color:#75af00>toTree</span> <span style=color:#f92672>::</span> <span style=color:#111>[</span><span style=color:#111>a</span><span style=color:#111>]</span> <span style=color:#f92672>-&gt;</span> <span style=color:#00a8c8>Tree</span> <span style=color:#111>a</span>
</code></pre></div><p>That takes a list and builds a tree of minimal depth.</p><p>You may find
<a href=https://hackage.haskell.org/package/base-4.14.1.0/docs/Prelude.html#v:splitAt><code>splitAt</code></a>
useful.</p><p>One thing you should check is that <code>toList . toTree</code> is the identity
on lists.</p><p>To check that you got things right, also define</p><div class=highlight><pre style=color:#272822;background-color:#fafafa><code class=language-hs data-lang=hs><span style=color:#75af00>depth</span> <span style=color:#f92672>::</span> <span style=color:#00a8c8>Tree</span> <span style=color:#f92672>-&gt;</span> <span style=color:#00a8c8>Int</span>
</code></pre></div><p>that returns the depth of a tree, defined as the length of its longest
branch from the root to any leaf.</p><p>You should then find that the depth of a tree constructed with
<code>toTree</code> grows like <code>logBase 2</code> of the length of the input list.</p></span></blockquote><p>We&rsquo;ll call binary trees <em>balanced</em> if the number of leaves in the left
and right subtrees of every <code>Node</code> differs by at most one (with leaves
being trivially balanced).</p><blockquote class=exercise><h3>Exercise</h3><span><p>Define a function</p><div class=highlight><pre style=color:#272822;background-color:#fafafa><code class=language-hs data-lang=hs><span style=color:#75af00>balanced</span> <span style=color:#f92672>::</span> <span style=color:#00a8c8>Tree</span> <span style=color:#111>a</span> <span style=color:#f92672>-&gt;</span> <span style=color:#00a8c8>Bool</span>
</code></pre></div><p>that determines if a tree is balanced or not.</p><details><summary>Hint</summary><div class=markdown-inner>Since your datatype is <code>Foldable</code> you can compute its <code>length</code>.</div></details></span></blockquote><blockquote class=question><h3>Question</h3><span><p>What complexity does your implementation of <code>balanced</code> have? Does it
traverse the tree only once (so linear complexity in the tree size),
or does it traverse many times?</p><details><summary>Hint</summary><div class=markdown-inner>If you used <code>length</code>, think about how that is implemented.</div></details><p>If you traversed more than once, can you think of a way to define
<code>balanced</code> that only visits each node in the tree at most once?</p><details><summary>Hint</summary><div class=markdown-inner>Think about what information you need to return at each level in the
recursion so that you don&rsquo;t need to go back down later to reconstruct
things.</div></details></span></blockquote><p>We&rsquo;ll call binary trees <em>symmetric</em> if we can draw a vertical line
through the root node such that right subtree is the mirror image of
the left subtree.</p><blockquote class=exercise><h3>Exercise</h3><span><p>Write a function</p><div class=highlight><pre style=color:#272822;background-color:#fafafa><code class=language-hs data-lang=hs><span style=color:#75af00>symmetric</span> <span style=color:#f92672>::</span> <span style=color:#00a8c8>Tree</span> <span style=color:#111>a</span> <span style=color:#f92672>-&gt;</span> <span style=color:#00a8c8>Bool</span>
</code></pre></div><p>that checks if a binary tree is structurally symmetric (that is the
shape is symmetric, but the values may differ).</p><details><summary>hint</summary><div class=markdown-inner><p>You might find it helpful to write</p><div class=highlight><pre style=color:#272822;background-color:#fafafa><code class=language-hs data-lang=hs><span style=color:#75af00>mirror</span> <span style=color:#f92672>::</span> <span style=color:#00a8c8>Tree</span> <span style=color:#111>a</span> <span style=color:#f92672>-&gt;</span> <span style=color:#00a8c8>Tree</span> <span style=color:#111>a</span> <span style=color:#f92672>-&gt;</span> <span style=color:#00a8c8>Bool</span>
</code></pre></div><p>to check if two trees are the mirror image of one another.</p></div></details></span></blockquote><h2 id=a-simple-calculator>A simple calculator
<a class=anchor href=#a-simple-calculator>#</a></h2><p>We will now build a tiny domain-specific language for integer
arithmetic expressions, and an evaluator for this language. We begin
by only supporting addition:</p><div class=highlight><pre style=color:#272822;background-color:#fafafa><code class=language-hs data-lang=hs><span style=color:#00a8c8>data</span> <span style=color:#00a8c8>Expr</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>Val</span> <span style=color:#00a8c8>Int</span> <span style=color:#f92672>|</span> <span style=color:#00a8c8>Add</span> <span style=color:#00a8c8>Expr</span> <span style=color:#00a8c8>Expr</span>
  <span style=color:#00a8c8>deriving</span> <span style=color:#111>(</span><span style=color:#00a8c8>Eq</span><span style=color:#111>,</span> <span style=color:#00a8c8>Show</span><span style=color:#111>)</span>
</code></pre></div><p>This says that an expression is either a <code>Val</code> (which contains
an <code>Int</code>) or else an <code>Add</code> which contains two expressions.
We make the expression representing $(1 + (4 + 5))$ like so:</p><div class=highlight><pre style=color:#272822;background-color:#fafafa><code class=language-hs data-lang=hs><span style=color:#75af00>expr</span> <span style=color:#f92672>=</span> <span style=color:#111>(</span><span style=color:#00a8c8>Add</span> <span style=color:#111>(</span><span style=color:#00a8c8>Val</span> <span style=color:#ae81ff>1</span><span style=color:#111>)</span> <span style=color:#111>(</span><span style=color:#00a8c8>Add</span> <span style=color:#111>(</span><span style=color:#00a8c8>Val</span> <span style=color:#ae81ff>4</span><span style=color:#111>)</span> <span style=color:#111>(</span><span style=color:#00a8c8>Val</span> <span style=color:#ae81ff>5</span><span style=color:#111>)))</span>
</code></pre></div><p>First, we will write some individual recursive functions to inspect
these expressions in some way. Then we will look at ways of
generalising the idea using higher-order functions.</p><blockquote class=exercise><h3>Exercise</h3><span><p>Define</p><ol><li>Evaluation of an expression<div class=highlight><pre style=color:#272822;background-color:#fafafa><code class=language-hs data-lang=hs><span style=color:#75af00>eval</span> <span style=color:#f92672>::</span> <span style=color:#00a8c8>Expr</span> <span style=color:#f92672>-&gt;</span> <span style=color:#00a8c8>Int</span>
</code></pre></div></li><li>Collecting a list of all <code>Val</code> nodes<div class=highlight><pre style=color:#272822;background-color:#fafafa><code class=language-hs data-lang=hs><span style=color:#75af00>collect</span> <span style=color:#f92672>::</span> <span style=color:#00a8c8>Expr</span> <span style=color:#f92672>-&gt;</span> <span style=color:#111>[</span><span style=color:#00a8c8>Val</span><span style=color:#111>]</span>
</code></pre></div></li><li>Counting how many <code>Val</code> nodes there are<div class=highlight><pre style=color:#272822;background-color:#fafafa><code class=language-hs data-lang=hs><span style=color:#75af00>size</span> <span style=color:#f92672>::</span> <span style=color:#00a8c8>Expr</span> <span style=color:#f92672>-&gt;</span> <span style=color:#00a8c8>Int</span>
</code></pre></div></li></ol></span></blockquote><p>In writing these functions, you should see that you produce the same
pattern each time. The <code>Val</code> node is replaced by some new value
constructed from the integer inside it, and the <code>Add</code> node is
replaced by some new value constructed from the replacement of both
its internal nodes. We will encapsulate this abstraction in the
function</p><div class=highlight><pre style=color:#272822;background-color:#fafafa><code class=language-hs data-lang=hs><span style=color:#75af00>folde</span> <span style=color:#f92672>::</span> <span style=color:#111>(</span><span style=color:#00a8c8>Int</span> <span style=color:#f92672>-&gt;</span> <span style=color:#111>a</span><span style=color:#111>)</span> <span style=color:#f92672>-&gt;</span> <span style=color:#111>(</span><span style=color:#111>a</span> <span style=color:#f92672>-&gt;</span> <span style=color:#111>a</span> <span style=color:#f92672>-&gt;</span> <span style=color:#111>a</span><span style=color:#111>)</span> <span style=color:#f92672>-&gt;</span> <span style=color:#00a8c8>Expr</span> <span style=color:#f92672>-&gt;</span> <span style=color:#111>a</span>
</code></pre></div><p>That is, <code>folde</code> eats a function <code>Int -> a</code> that converts <code>Val</code>
nodes into type <code>a</code>, a function <code>a -> a -> a</code> that
converts <code>Add</code> nodes into type <code>a</code> by eating both their
converted children, and an <code>Expr</code>, returning a value of type
<code>a</code>.</p><p>As an example, we can implement <code>eval</code> using this new function
like so:</p><div class=highlight><pre style=color:#272822;background-color:#fafafa><code class=language-hs data-lang=hs><span style=color:#75af00>eval</span> <span style=color:#f92672>::</span> <span style=color:#00a8c8>Expr</span> <span style=color:#f92672>-&gt;</span> <span style=color:#00a8c8>Int</span>
<span style=color:#75af00>eval</span> <span style=color:#111>expr</span> <span style=color:#f92672>=</span> <span style=color:#111>folde</span> <span style=color:#111>id</span> <span style=color:#111>(</span><span style=color:#f92672>+</span><span style=color:#111>)</span> <span style=color:#111>expr</span>
</code></pre></div><p>This says: &ldquo;replace <code>Val</code> nodes with their contents, and replace
<code>Add</code> nodes with the summation of their contents&rdquo;.</p><blockquote class=exercise><h3>Exercise</h3><span>Implement <code>folde</code> and then the functions <code>collect</code> and <code>size</code> using it.</span></blockquote><div class=markdown-inner><h2 id=solutions>Solutions</h2><p>I&rsquo;ve added some <a href=https://comp2221.github.io/fp-website/code/exercises/exercise6-solutions.hs>commented solutions</a> to these exercises. If you
have queries about them please ask in the practical sessions or else
<a href=https://comp2221.github.io/fp-website/#discussion-forum>get in touch</a>.</div></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/comp2221/fp-website/commit/3615623ed717c514ec9765fe2414690fc3a9df1c title="Last modified by Laura Morgenstern | February 13, 2024" target=_blank rel=noopener><img src=/fp-website/svg/calendar.svg class=book-icon alt=Calendar>
<span>February 13, 2024</span></a></div><div><a class="flex align-center" href=https://github.com/comp2221/fp-website/edit/main/site/content/exercises/exercise6.md target=_blank rel=noopener><img src=/fp-website/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><div class="flex flex-wrap align-right"><p>© 2021&ndash; <a href=mailto:lawrence@wence.uk>Lawrence Mitchell</a>, <a href=mailto:laura.morgenstern@durham.ac.uk>Laura Morgenstern</a> & <a href=https://www.dur.ac.uk/>Durham University</a>.</p><p><a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/><img alt="Creative Commons License" style=border-width:0 src=/fp-website/cc-by-sa.svg></a>
This work is licensed under a <a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/>Creative
Commons Attribution-ShareAlike 4.0 International License</a>.</p></div></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#manipulating-data-types>Manipulating data types</a><ul><li><a href=#a-binary-tree>A binary tree</a></li><li><a href=#a-simple-calculator>A simple calculator</a></li></ul></li></ul></nav></aside></main></body></html>